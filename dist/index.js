!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("react"));else if("function"==typeof define&&define.amd)define(["react"],e);else{var i="object"==typeof exports?e(require("react")):e(t.react);for(var n in i)("object"==typeof exports?exports:t)[n]=i[n]}}(window,function(i){return s={},a.m=n=[function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.exports=function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}},function(t,e){t.exports=i},function(t,e,i){var n=i(5),a=i(6),s=i(7);t.exports=function(t){return n(t)||a(t)||s()}},function(e,t){function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t){return"function"==typeof Symbol&&"symbol"===i(Symbol.iterator)?e.exports=n=function(t){return i(t)}:e.exports=n=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":i(t)},n(t)}e.exports=n},function(t,e){t.exports=function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}},function(t,e){t.exports=function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},function(t,e,i){"use strict";i.r(e);function s(e,i){var n=[];return e.forEach?e.forEach(function(t){i(t)&&n.push(t)}):Object.keys(e).forEach(function(t){i(e[t])&&n.push(e[t])}),n}function o(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};a()(this,o),this.components=t,this.entities=e,this.array=[]}var n=i(0),a=i.n(n),r=i(1),h=i.n(r),u=i(3),l=i.n(u);o.groups={},o.reset=function(){o.groups={}},o.generateGroupKey=function(t){for(var e=[],i=0;i<t.length;i++){var n=t[i];e.push(n)}return e.map(function(t){return t.toLowerCase()}).sort().join("-")},o.getGroup=function(t){var e=o.generateGroupKey(t);return o.groups[e]||{}},o.indexGroup=function(t,e){var i,n=t.reduce?t:[t],a=o.generateGroupKey(n);if(!o.groups[a])return i=o.groups[a]=new o(n),s(e,function(t){t.hasComponents(n)&&(i.entities[t.id]=t,i.array=[].concat(l()(i.array),[t]))}),i};function c(t,e){var i=1<arguments.length&&void 0!==e?e:0,n=t.length;if(n&&!(n<=i)){for(;i<n;)t[i]=t[i+1],i++;t.length--}}var p=o,d=function(){function o(t){a()(this,o),o.counter++,this.id=o.counter,this.constructor=t,this.components={},o.entities[this.id]=this}return h()(o,[{key:"assignGroup",value:function(t){t.entities[this.id]=this}},{key:"addComponent",value:function(t){this.components[t.name]=t,this[t.name]=t;var e=[];for(var i in this.components)e.push(i);for(var n in p.indexGroup(e,o.entities),p.groups){var a=p.groups[n];if(!a.entities[this.id]&&(-1!==a.components.indexOf(t.name)&&this.hasComponents(a.components))){this.assignGroup(a);var s=this.copyArray(a);a.array=this.extendGroup(s)}}}},{key:"copyArray",value:function(t){return t.array}},{key:"extendGroup",value:function(t){return t[t.length]=this,t}},{key:"removeComponent",value:function(t){var e=this.components[t]||t,i=e.name;for(var n in p.groups){var a=p.groups[n],s=-1<a.components.indexOf(e.name),o=this.hasComponents(a.components);a.entities[this.id]&&s&&o&&(delete a.entities[this.id],c(a.array,a.array.indexOf(this)))}delete this.components[i],delete this[i]}},{key:"destroy",value:function(){var e=this;Object.keys(this.components).forEach(function(t){e.removeComponent(e.components[t])}),delete o.entities[this.id]}},{key:"hasComponents",value:function(t){var i=this,e=0<arguments.length&&void 0!==t?t:[];return!!this.components[e]||(e.reduce?e:[e]).reduce(function(t,e){return t&&!!i.components[e]},!0)}}]),o}();d.entities={},d.getByComps=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"array",i=t.reduce?t:[t];p.indexGroup(t,d.entities);var n=p.getGroup(i);return"map"===e?n.entities:n.array.concat()},d.reset=function(){s(d.entities,function(t){t.destroy()}),p.reset()},d.counter=0;function y(t,e){a()(this,y),this.draw=t,this.metaData=e}var v=window.Entity=d,f=function(){function i(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:10;a()(this,i),this.type=t,this.freePool=[],this.stats={free:0,used:0},this.incrementWhenEmpty=e}return h()(i,[{key:"reset",value:function(){this.freePool=[],this.stats={free:0,used:0}}},{key:"generate",value:function(t){for(var e=0<t-this.stats.free?t-this.stats.free:0;0<e;)this.freePool.push(new this.type),e--;this.stats.free=this.freePool.length}},{key:"acquire",value:function(){0===this.freePool.length&&this.generate(this.incrementWhenEmpty);var t=this.freePool.pop();return this.stats.free=this.freePool.length,t}},{key:"release",value:function(t){-1===this.freePool.indexOf(t)&&(this.freePool.push(t),this.stats.free=this.freePool.length)}}]),i}(),M=i(2),m=i.n(M);var g=function(){function i(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"white";a()(this,i),this.layers={initial:{ctx:t,shapes:new Map}},this.defaultStrokeStyle=e,t.strokeStyle=e}return h()(i,[{key:"addLayer",value:function(t){if(!this.layers.initial.ctx)throw"Cannot create layer, no initial context found";var e=this.layers.initial.ctx.canvas,i=e.parentNode,n=e.cloneNode();n.id=t,i.insertBefore(n,e),this.layers[t]={ctx:n.getContext("2d"),shapes:new Map}}},{key:"removeLayer",value:function(t){this.layers.initial.ctx.canvas.parentNode.querySelector("#".concat(t)).remove(),delete this.layers[t]}},{key:"clear",value:function(t){var e=0<arguments.length&&void 0!==t?t:"initial",i=this.layers[e];i.ctx;i.shapes=new Map}},{key:"clearAllLayers",value:function(){for(var t in this.layers)this.clear(t)}},{key:"remove",value:function(t,e){var i=1<arguments.length&&void 0!==e?e:"initial",n=this.layers[i];n.ctx;n.shapes.delete(t)}},{key:"addImage",value:function(t,e){var i=t.id,n=t.image,a=t.x,s=t.y,o=t.height,r=t.width,h=t.cropStartX,u=t.cropStartY,l=t.cropSizeX,c=t.cropSizeY,p=t.rotation,d=1<arguments.length&&void 0!==e?e:"initial",v=this.layers[d],f=v.ctx;v.shapes.set(i,new y(function(){f.beginPath(),f.save(),f.translate(a+r/2,s+o/2),f.rotate(p),f.drawImage(n,h,u,l,c,-r/2,-o/2,r,o),f.restore(),f.closePath()},{id:i,type:"image",x:a,y:s,height:o,width:r}))}},{key:"addShape",value:function(t){var e=t.id,i=t.drawFn,n=t.layerName,a=void 0===n?"initial":n,s=this.layers[a],o=s.ctx;s.shapes.set(e,new y(function(){i(o)}))}},{key:"addRect",value:function(t,e){var i=t.id,n=t.x,a=t.y,s=t.width,o=t.height,r=t.strokeStyle,h=t.lineWidth,u=1<arguments.length&&void 0!==e?e:"initial",l=this.layers[u],c=l.ctx;l.shapes.set(i,new y(function(){c.strokeStyle=r,c.lineWidth=h,c.beginPath(),c.rect(n,a,s,o),c.stroke(),c.closePath()},{id:i,type:"rect",x:n,y:a,height:o,width:s}))}},{key:"addArc",value:function(t){var e=t.id,i=t.direction,n=t.size,a=t.color,s=void 0===a?"black":a,o=t.fillColor,r=t.lineWidth,h=void 0===r?1:r,u=t.x,l=t.y,c=t.radius,p=t.layerName,d=void 0===p?"initial":p,v=this.layers[d],f=v.ctx;v.shapes.set(e,new y(function(){f.strokeStyle=s,f.lineWidth=h;var t=i-n/2,e=i+n/2;f.beginPath(),f.arc(u,l,c,t*Math.PI,e*Math.PI),o&&(f.fillStyle=o,f.fill()),f.stroke(),f.closePath()}))}},{key:"addCircle",value:function(t,e){var i=t.id,n=t.x,a=t.y,s=t.radius,o=t.strokeStyle,r=t.lineWidth,h=t.fillColor,u=1<arguments.length&&void 0!==e?e:"initial",l=this.layers[u],c=l.ctx;l.shapes.set(i,new y(function(){c.strokeStyle=o,c.lineWidth=r,c.moveTo(n,a),c.beginPath(),c.arc(n,a,s,0,2*Math.PI),h&&(c.fillStyle=h,c.fill()),c.stroke(),c.closePath()},{id:i,type:"circle",x:n,y:a,radius:s}))}},{key:"pan",value:function(t,e){for(var i in this.panX=t,this.panY=e,this.layers){this.layers[i].ctx.setTransform(1,0,0,1,t,e),"initial"!==i&&this.draw(i)}}},{key:"getPan",value:function(){return{panX:this.panX||0,panY:this.panY||0}}},{key:"write",value:function(t,e){var i=t.id,n=t.text,a=t.x,s=t.y,o=t.font,r=t.textBaseline,h=t.fillStyle,u=1<arguments.length&&void 0!==e?e:"initial",l=this.layers[u],c=l.ctx;l.shapes.set(i,new y(function(){c.beginPath(),c.font=o,c.textBaseline=r,c.fillStyle=h,c.fillText(n,a,s),c.closePath()},{id:i,x:a,y:s}))}},{key:"draw",value:function(t){var e=0<arguments.length&&void 0!==t?t:"initial",i=this.layers[e],n=i.ctx,a=i.shapes;n.save(),n.setTransform(1,0,0,1,0,0),n.clearRect(0,0,n.canvas.width,n.canvas.height),n.restore();var s=!0,o=!1,r=void 0;try{for(var h,u=a.values()[Symbol.iterator]();!(s=(h=u.next()).done);s=!0){h.value.draw(),n.strokeStyle=this.defaultStrokeStyle}}catch(t){o=!0,r=t}finally{try{s||null==u.return||u.return()}finally{if(o)throw r}}}}]),i}(),w=function(){function t(){a()(this,t),this.reset()}return h()(t,[{key:"reset",value:function(){this.start={x:0,y:0},this.end={x:0,y:0}}},{key:"getData",value:function(){return{start:Object.assign({},this.start),end:Object.assign({},this.end),width:this.getWidth(),height:this.getHeight()}}},{key:"getHeight",value:function(){return this.end.y-this.start.y}},{key:"getWidth",value:function(){return this.end.x-this.start.x}},{key:"setStart",value:function(t,e){this.start.x=t,this.start.y=e}},{key:"setEnd",value:function(t,e){this.end.x=t,this.end.y=e}}]),t}();var x=function(t,e,i,n,a){return Math.pow(t-i,2)+Math.pow(e-n,2)<Math.pow(a,2)};var k=function(t,o,r){var h=[];return t.forEach(function(t,e){var i=t.metaData,n=i.x,a=i.y,s=i.radius;"circle"===i.type&&x(o,r,n,a,s)&&h.push(e)}),h};var b=function(t,e){var s=Math.min(e.start.x,e.end.x),o=Math.max(e.start.x,e.end.x),r=Math.min(e.start.y,e.end.y),h=Math.max(e.start.y,e.end.y),u=[];return t.forEach(function(t,e){var i=t.metaData,n=i.x,a=i.y;if("circle"===i.type){s<=n&&n<=o&&r<=a&&a<=h&&u.push(e)}}),u},P=function(){function e(t){a()(this,e),this.selectedBoxColor=t.selectedBoxColor||"blue",this.mapHeight=t.mapHeight,this.mapWidth=t.mapWidth,this.viewHeight=t.viewHeight,this.viewWidth=t.viewWidth,this.onViewMapClick=t.onViewMapClick,this.onViewMapMove=t.onViewMapMove,this.onMiniMapClick=t.onMiniMapClick,this.onMiniMapMove=t.onMiniMapMove,this.lastClick=0,this.dbClick=!1,this.lastTap=0,this.lastClick=!1,this.selectedBox=new w,this.updateViewMapCursorPosition=this.updateViewMapCursorPosition.bind(this),this.updateMiniMapCursorPosition=this.updateMiniMapCursorPosition.bind(this),this.handleMapMouseUp=this.handleMapMouseUp.bind(this),this.handleMapMouseDown=this.handleMapMouseDown.bind(this),this.handleMiniMapClick=this.handleMiniMapClick.bind(this),this.handleMiniMapMove=this.handleMiniMapMove.bind(this),this.handleMapMouseMove=this.handleMapMouseMove.bind(this),this.handleMapMouseLeave=this.handleMapMouseLeave.bind(this),this.handleTouchMove=this.handleTouchMove.bind(this),this.handleTouchStart=this.handleTouchStart.bind(this),this.handleMapTouchEnd=this.handleMapTouchEnd.bind(this),this.handleMiniMapTouchStart=this.handleMiniMapTouchStart.bind(this)}return h()(e,[{key:"updateCursorPosition",value:function(t,e,i){var n=e.getBoundingClientRect(),a=t.clientX-n.left,s=t.clientY-n.top;return{x:a=Math.max(0,Math.round(a*(e.width/n.width)))-i.getPan().panX,y:s=Math.max(0,Math.round(s*(e.height/n.height)))-i.getPan().panY}}},{key:"handleMapMouseMove",value:function(){if(this.isMouseDown){this.selectedBox.setEnd(this.viewMapX,this.viewMapY);var t=this.selectedBox.getData();this.mapAPI.addRect({id:"selectedBox",x:t.start.x,y:t.start.y,width:t.width,height:t.height,strokeStyle:this.selectedBoxColor})}this.onViewMapMove({x:this.viewMapX,y:this.viewMapY,isMouseDown:this.isMouseDown,dbClick:this.dbClick,selectedBox:this.selectedBox.getData()})}},{key:"handleMapMouseLeave",value:function(){this.isMouseDown&&this.handleMapMouseUp()}},{key:"handleMapTouchEnd",value:function(){this.isMouseDown=!1;var t=this.selectedBox.getData(),e=[];if(t.end.x===t.start.x){var i=t.end.x,n=t.end.y;e=k(this.mapAPI.layers.initial.shapes,i,n)}else e=b(this.mapAPI.layers.initial.shapes,t);this.mapAPI.addRect({id:"selectedBox",x:0,y:0,width:0,height:0}),this.onViewMapClick({x:this.viewMapX,y:this.viewMapY,isMouseDown:this.isMouseDown,dbClick:this.dbTap||this.dbClick,selectedBox:t,hits:e}),this.selectedBox.reset()}},{key:"handleMapMouseUp",value:function(){this.lastTap||this.handleMapTouchEnd()}},{key:"updateViewMapCursorPosition",value:function(t){var e=this.updateCursorPosition(t,this.viewMapCanvas,this.mapAPI),i=e.x,n=e.y;this.viewMapX=i,this.viewMapY=n}},{key:"updateMiniMapCursorPosition",value:function(t){var e=this.updateCursorPosition(t,this.miniMapCanvas,this.miniMapAPI),i=e.x,n=e.y;this.miniMapX=i,this.miniMapY=n}},{key:"getNewCanvasPairs",value:function(t){var e=t.getMapRef,i=t.getMiniRef;return{map:this.generateMapCanvas(e),minimap:this.generateMiniMapCanvas(i)}}},{key:"handleMiniMapMove",value:function(t){this.onMiniMapMove(t)}},{key:"handleMiniMapClick",value:function(t){var e=this.miniMapX,i=this.miniMapY,n=Math.max(e-this.viewWidth/2,0),a=Math.max(i-this.viewHeight/2,0),s=this.mapWidth,o=this.mapHeight;n=n+this.viewWidth<s?n:s-this.viewWidth,a=a+this.viewHeight<o?a:o-this.viewHeight,this.mapAPI.pan(-n,-a),this.updateMiniMapSquare(),this.onMiniMapClick(t)}},{key:"updateMiniMapSquare",value:function(){this.miniMapAPI.addRect({id:"currentMap",x:-this.mapAPI.getPan().panX,y:-this.mapAPI.getPan().panY,width:this.viewWidth,height:this.viewHeight,strokeStyle:"green",lineWidth:20})}},{key:"handleMapMouseDown",value:function(){if(!this.lastTap){var t=(new Date).getTime();this.dbClick=t-this.lastClick<300,this.lastClick=t,this.isMouseDown=!0,this.setSelectBox()}}},{key:"setSelectBox",value:function(){this.selectedBox.setStart(this.viewMapX,this.viewMapY),this.selectedBox.setEnd(this.viewMapX,this.viewMapY)}},{key:"handleTouchStart",value:function(t){var e=this.updateCursorPosition(t.touches[0],this.viewMapCanvas,this.mapAPI),i=e.x,n=e.y,a=(new Date).getTime();this.dbTap=a-this.lastTap<300,this.lastTap=a,this.viewMapX=i,this.viewMapY=n,this.setSelectBox()}},{key:"handleMiniMapTouchStart",value:function(t){var e=this.updateCursorPosition(t.touches[0],this.miniMapCanvas,this.miniMapAPI),i=e.x,n=e.y;this.miniMapX=i,this.miniMapY=n,this.handleMiniMapClick()}},{key:"handleTouchMove",value:function(t){t.preventDefault();var e,i,n=this.updateCursorPosition(t.touches[0],this.viewMapCanvas,this.mapAPI),a=n.x,s=n.y,o=this.mapAPI.getPan(),r=o.panX,h=o.panY;e=r+(a-this.viewMapX),i=h+(s-this.viewMapY),e=Math.min(e,0),i=Math.min(i,0);var u=this.mapWidth,l=this.mapHeight;e=-e+this.viewWidth<u?e:this.viewWidth-u,i=-i+this.viewHeight<l?i:this.viewHeight-l,this.mapAPI.pan(e,i)}},{key:"generateMapCanvas",value:function(e){var i=this;return m.a.createElement("canvas",{className:"viewMap",ref:function(t){if(!t)return null;i.viewMapCanvas=t,document.removeEventListener("mousemove",i.updateViewMapCursorPosition),document.addEventListener("mousemove",i.updateViewMapCursorPosition),t.removeEventListener("touchmove",i.handleTouchMove,!1),t.addEventListener("touchmove",i.handleTouchMove,!1),i.mapAPI=new g(t.getContext("2d")),e(i.mapAPI,t)},height:this.viewHeight,width:this.viewWidth,onMouseDown:this.handleMapMouseDown,onTouchStart:this.handleTouchStart,onTouchEnd:this.handleMapTouchEnd,onMouseMove:this.handleMapMouseMove,onMouseUp:this.handleMapMouseUp,onMouseLeave:this.handleMapMouseLeave})}},{key:"generateMiniMapCanvas",value:function(i){var n=this;return m.a.createElement("canvas",{className:"minimap",ref:function(t){if(!t)return null;n.miniMapCanvas=t,document.removeEventListener("mousemove",n.updateMiniMapCursorPosition),document.addEventListener("mousemove",n.updateMiniMapCursorPosition),n.miniMapAPI=new g(t.getContext("2d"));var e=setInterval(function(){n.mapAPI&&(n.updateMiniMapSquare(),clearInterval(e))},100);i(n.miniMapAPI,t)},height:this.mapHeight,width:this.mapWidth,onMouseMove:this.handleMiniMapMove,onMouseDown:this.handleMiniMapClick,onTouchStart:this.handleMiniMapTouchStart})}}]),e}(),C=i(4),S=i.n(C),T=function(){function t(){a()(this,t),this.systems=[],this.frameID=null}return h()(t,[{key:"addSystem",value:function(t){this.systems.push(t)}},{key:"run",value:function(e){var i=this;this.frameID=requestAnimationFrame(function(){var t="function"==typeof e?e():e;if("object"!==S()(t))throw"Expecting systemArguments to be of type object";i.runSystems(t),i.run(e)})}},{key:"runSystems",value:function(t){for(var e=0;e<this.systems.length;e++)this.systems[e](t)}},{key:"stop",value:function(){cancelAnimationFrame(this.frameID)}}]),t}();e.default={Entity:v,entityLoop:s,ObjectPool:f,GameCanvas:P,Engine:T}}],a.c=s,a.d=function(t,e,i){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(i,n,function(t){return e[t]}.bind(null,n));return i},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/",a(a.s=8);function a(t){if(s[t])return s[t].exports;var e=s[t]={i:t,l:!1,exports:{}};return n[t].call(e.exports,e,e.exports,a),e.l=!0,e.exports}var n,s});
//# sourceMappingURL=index.js.map