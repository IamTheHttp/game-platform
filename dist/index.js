!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("react"));else if("function"==typeof define&&define.amd)define(["react"],e);else{var i="object"==typeof exports?e(require("react")):e(t.react);for(var n in i)("object"==typeof exports?exports:t)[n]=i[n]}}(window,function(i){return s={},a.m=n=[function(t,e){t.exports=i},function(t,e,i){"use strict";i.r(e);function s(e,i){var n=[];return e.forEach?e.forEach(function(t){i(t)&&n.push(t)}):Object.keys(e).forEach(function(t){i(e[t])&&n.push(e[t])}),n}function o(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function r(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),this.components=t,this.entities=e,this.array=[]}r.groups={},r.reset=function(){r.groups={}},r.generateGroupKey=function(t){for(var e=[],i=0;i<t.length;i++){var n=t[i];e.push(n)}return e.map(function(t){return t.toLowerCase()}).sort().join("-")},r.getGroup=function(t){var e=r.generateGroupKey(t);return r.groups[e]||{}},r.indexGroup=function(t,e){var i,n=t.reduce?t:[t],a=r.generateGroupKey(n);if(!r.groups[a])return i=r.groups[a]=new r(n),s(e,function(t){t.hasComponents(n)&&(i.entities[t.id]=t,i.array=[].concat(o(i.array),[t]))}),i};var h=r;function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function u(t,e){var i=1<arguments.length&&void 0!==e?e:0,n=t.length;if(n&&!(n<=i)){for(;i<n;)t[i]=t[i+1],i++;t.length--}}var a=function(){function o(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),o.counter++,this.id=o.counter,this.constructor=t,this.components={},o.entities[this.id]=this}return function(t,e,i){e&&n(t.prototype,e),i&&n(t,i)}(o,[{key:"assignGroup",value:function(t){t.entities[this.id]=this}},{key:"addComponent",value:function(t){this.components[t.name]=t,this[t.name]=t;var e=[];for(var i in this.components)e.push(i);for(var n in h.indexGroup(e,o.entities),h.groups){var a=h.groups[n];if(!a.entities[this.id]&&(-1!==a.components.indexOf(t.name)&&this.hasComponents(a.components))){this.assignGroup(a);var s=this.copyArray(a);a.array=this.extendGroup(s)}}}},{key:"copyArray",value:function(t){return t.array}},{key:"extendGroup",value:function(t){return t[t.length]=this,t}},{key:"removeComponent",value:function(t){var e=this.components[t]||t,i=e.name;for(var n in h.groups){var a=h.groups[n],s=-1<a.components.indexOf(e.name),o=this.hasComponents(a.components);a.entities[this.id]&&s&&o&&(delete a.entities[this.id],u(a.array,a.array.indexOf(this)))}delete this.components[i],delete this[i]}},{key:"destroy",value:function(){var e=this;Object.keys(this.components).forEach(function(t){e.removeComponent(e.components[t])}),delete o.entities[this.id]}},{key:"hasComponents",value:function(t){var i=this,e=0<arguments.length&&void 0!==t?t:[];return!!this.components[e]||(e.reduce?e:[e]).reduce(function(t,e){return t&&!!i.components[e]},!0)}}]),o}();a.entities={},a.getByComps=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"array",i=t.reduce?t:[t];h.indexGroup(t,a.entities);var n=h.getGroup(i);return"map"===e?n.entities:n.array.concat()},a.reset=function(){s(a.entities,function(t){t.destroy()}),h.reset()},a.counter=0;var c=window.Entity=a;function l(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var p=function(){function i(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:10;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),this.type=t,this.freePool=[],this.stats={free:0,used:0},this.incrementWhenEmpty=e}return function(t,e,i){e&&l(t.prototype,e),i&&l(t,i)}(i,[{key:"reset",value:function(){this.freePool=[],this.stats={free:0,used:0}}},{key:"generate",value:function(t){for(var e=0<t-this.stats.free?t-this.stats.free:0;0<e;)this.freePool.push(new this.type),e--;this.stats.free=this.freePool.length}},{key:"acquire",value:function(){0===this.freePool.length&&this.generate(this.incrementWhenEmpty);var t=this.freePool.pop();return this.stats.free=this.freePool.length,t}},{key:"release",value:function(t){-1===this.freePool.indexOf(t)&&(this.freePool.push(t),this.stats.free=this.freePool.length)}}]),i}(),d=i(0),f=i.n(d);function v(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function M(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function y(t,e){M(this,y),this.draw=t,this.metaData=e}var m=function(){function i(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"white";M(this,i),this.ctx=t,this.defaultStrokeStyle=e,t.strokeStyle=e,this.shapes=new Map}return function(t,e,i){e&&v(t.prototype,e),i&&v(t,i)}(i,[{key:"clear",value:function(){this.shapes=new Map}},{key:"remove",value:function(t){this.shapes.delete(t)}},{key:"addImage",value:function(t){var e=t.id,i=t.image,n=t.x,a=t.y,s=t.height,o=t.width,r=t.cropStartX,h=t.cropStartY,u=t.cropSizeX,c=t.cropSizeY,l=t.rotation,p=this.ctx;this.shapes.set(e,new y(function(){p.beginPath(),p.save(),p.translate(n+o/2,a+s/2),p.rotate(l),p.drawImage(i,r,h,u,c,-o/2,-s/2,o,s),p.restore(),p.closePath()},{id:e,type:"image",x:n,y:a,height:s,width:o}))}},{key:"addRect",value:function(t){var e=t.id,i=t.x,n=t.y,a=t.width,s=t.height,o=t.strokeStyle,r=t.lineWidth,h=this.ctx;this.shapes.set(e,new y(function(){h.strokeStyle=o,h.lineWidth=r,h.beginPath(),h.rect(i,n,a,s),h.stroke(),h.closePath()},{id:e,type:"rect",x:i,y:n,height:s,width:a}))}},{key:"addCircle",value:function(t){var e=t.id,i=t.x,n=t.y,a=t.radius,s=t.strokeStyle,o=t.lineWidth,r=t.fillColor,h=this.ctx;this.shapes.set(e,new y(function(){h.strokeStyle=s,h.lineWidth=o,h.moveTo(i,n),h.beginPath(),h.arc(i,n,a,0,2*Math.PI),r&&(h.fillStyle=r,h.fill()),h.stroke(),h.closePath()},{id:e,type:"circle",x:i,y:n,radius:a}))}},{key:"pan",value:function(t,e){this.panX=t,this.panY=e,this.ctx.setTransform(1,0,0,1,t,e)}},{key:"getPan",value:function(){return{panX:this.panX||0,panY:this.panY||0}}},{key:"write",value:function(t){var e=this,i=t.id,n=t.text,a=t.x,s=t.y,o=t.font,r=t.textBaseline,h=t.fillStyle;this.shapes.set(i,new y(function(){e.ctx.beginPath(),e.ctx.font=o,e.ctx.textBaseline=r,e.ctx.fillStyle=h,e.ctx.fillText(n,a,s),e.ctx.closePath()},{id:i,x:a,y:s}))}},{key:"draw",value:function(){this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore();var t=!0,e=!1,i=void 0;try{for(var n,a=this.shapes.values()[Symbol.iterator]();!(t=(n=a.next()).done);t=!0){n.value.draw(),this.ctx.strokeStyle=this.defaultStrokeStyle}}catch(t){e=!0,i=t}finally{try{t||null==a.return||a.return()}finally{if(e)throw i}}}}]),i}();function w(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var g=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.reset()}return function(t,e,i){e&&w(t.prototype,e),i&&w(t,i)}(t,[{key:"reset",value:function(){this.start={x:0,y:0},this.end={x:0,y:0}}},{key:"getData",value:function(){return{start:Object.assign({},this.start),end:Object.assign({},this.end),width:this.getWidth(),height:this.getHeight()}}},{key:"getHeight",value:function(){return this.end.y-this.start.y}},{key:"getWidth",value:function(){return this.end.x-this.start.x}},{key:"setStart",value:function(t,e){this.start.x=t,this.start.y=e}},{key:"setEnd",value:function(t,e){this.end.x=t,this.end.y=e}}]),t}();var x=function(t,e,i,n,a){return Math.pow(t-i,2)+Math.pow(e-n,2)<Math.pow(a,2)};var k=function(t,o,r){var h=[];return t.forEach(function(t,e){var i=t.metaData,n=i.x,a=i.y,s=i.radius;"circle"===i.type&&x(o,r,n,a,s)&&h.push(e)}),h};var b=function(t,e){var s=Math.min(e.start.x,e.end.x),o=Math.max(e.start.x,e.end.x),r=Math.min(e.start.y,e.end.y),h=Math.max(e.start.y,e.end.y),u=[];return t.forEach(function(t,e){var i=t.metaData,n=i.x,a=i.y;if("circle"===i.type){s<=n&&n<=o&&r<=a&&a<=h&&u.push(e)}}),u};function P(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var C=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.selectedBoxColor=t.selectedBoxColor||"blue",this.mapHeight=t.mapHeight,this.mapWidth=t.mapWidth,this.viewHeight=t.viewHeight,this.viewWidth=t.viewWidth,this.onViewMapClick=t.onViewMapClick,this.onViewMapMove=t.onViewMapMove,this.lastClick=0,this.dbClick=!1,this.lastTap=0,this.lastClick=!1,this.selectedBox=new g,this.updateViewMapCursorPosition=this.updateViewMapCursorPosition.bind(this),this.updateMiniMapCursorPosition=this.updateMiniMapCursorPosition.bind(this),this.handleMapMouseUp=this.handleMapMouseUp.bind(this),this.handleMapMouseDown=this.handleMapMouseDown.bind(this),this.handleMiniMapClick=this.handleMiniMapClick.bind(this),this.handleMapMouseMove=this.handleMapMouseMove.bind(this),this.handleMapMouseLeave=this.handleMapMouseLeave.bind(this),this.handleTouchMove=this.handleTouchMove.bind(this),this.handleTouchStart=this.handleTouchStart.bind(this),this.handleMapTouchEnd=this.handleMapTouchEnd.bind(this),this.handleMiniMapTouchStart=this.handleMiniMapTouchStart.bind(this)}return function(t,e,i){e&&P(t.prototype,e),i&&P(t,i)}(e,[{key:"updateCursorPosition",value:function(t,e,i){var n=e.getBoundingClientRect(),a=t.clientX-n.left,s=t.clientY-n.top;return{x:a=Math.max(0,Math.round(a*(e.width/n.width)))-i.getPan().panX,y:s=Math.max(0,Math.round(s*(e.height/n.height)))-i.getPan().panY}}},{key:"handleMapMouseMove",value:function(){if(this.isMouseDown){this.selectedBox.setEnd(this.viewMapX,this.viewMapY);var t=this.selectedBox.getData();this.mapAPI.addRect({id:"selectedBox",x:t.start.x,y:t.start.y,width:t.width,height:t.height,strokeStyle:this.selectedBoxColor})}this.onViewMapMove({x:this.viewMapX,y:this.viewMapY,isMouseDown:this.isMouseDown,dbClick:this.dbClick,selectedBox:this.selectedBox.getData()})}},{key:"handleMapMouseLeave",value:function(){this.isMouseDown&&this.handleMapMouseUp()}},{key:"handleMapTouchEnd",value:function(){this.isMouseDown=!1;var t=this.selectedBox.getData(),e=[];if(t.end.x===t.start.x){var i=t.end.x,n=t.end.y;e=k(this.mapAPI.shapes,i,n)}else e=b(this.mapAPI.shapes,t);this.mapAPI.addRect({id:"selectedBox",x:0,y:0,width:0,height:0}),this.onViewMapClick({x:this.viewMapX,y:this.viewMapY,isMouseDown:this.isMouseDown,dbClick:this.dbTap||this.dbClick,selectedBox:t,hits:e}),this.selectedBox.reset()}},{key:"handleMapMouseUp",value:function(){this.lastTap||this.handleMapTouchEnd()}},{key:"updateViewMapCursorPosition",value:function(t){var e=this.updateCursorPosition(t,this.viewMapCanvas,this.mapAPI),i=e.x,n=e.y;this.viewMapX=i,this.viewMapY=n}},{key:"updateMiniMapCursorPosition",value:function(t){var e=this.updateCursorPosition(t,this.miniMapCanvas,this.miniMapAPI),i=e.x,n=e.y;this.miniMapX=i,this.miniMapY=n}},{key:"getNewCanvasPairs",value:function(t){var e=t.getMapRef,i=t.getMiniRef;return{map:this.generateMapCanvas(e),minimap:this.generateMiniMapCanvas(i)}}},{key:"handleMiniMapClick",value:function(){var t=this.miniMapX,e=this.miniMapY,i=Math.max(t-this.viewWidth/2,0),n=Math.max(e-this.viewHeight/2,0),a=this.mapWidth,s=this.mapHeight;i=i+this.viewWidth<a?i:a-this.viewWidth,n=n+this.viewHeight<s?n:s-this.viewHeight,this.mapAPI.pan(-i,-n),this.updateMiniMapSquare()}},{key:"updateMiniMapSquare",value:function(){this.miniMapAPI.addRect({id:"currentMap",x:-this.mapAPI.getPan().panX,y:-this.mapAPI.getPan().panY,width:this.viewWidth,height:this.viewHeight,strokeStyle:"green",lineWidth:20})}},{key:"handleMapMouseDown",value:function(){if(!this.lastTap){var t=(new Date).getTime();this.dbClick=t-this.lastClick<300,this.lastClick=t,this.isMouseDown=!0,this.setSelectBox()}}},{key:"setSelectBox",value:function(){this.selectedBox.setStart(this.viewMapX,this.viewMapY),this.selectedBox.setEnd(this.viewMapX,this.viewMapY)}},{key:"handleTouchStart",value:function(t){var e=this.updateCursorPosition(t.touches[0],this.viewMapCanvas,this.mapAPI),i=e.x,n=e.y,a=(new Date).getTime();this.dbTap=a-this.lastTap<300,this.lastTap=a,this.viewMapX=i,this.viewMapY=n,this.setSelectBox()}},{key:"handleMiniMapTouchStart",value:function(t){var e=this.updateCursorPosition(t.touches[0],this.miniMapCanvas,this.miniMapAPI),i=e.x,n=e.y;this.miniMapX=i,this.miniMapY=n,this.handleMiniMapClick()}},{key:"handleTouchMove",value:function(t){t.preventDefault();var e,i,n=this.updateCursorPosition(t.touches[0],this.viewMapCanvas,this.mapAPI),a=n.x,s=n.y,o=this.mapAPI.getPan(),r=o.panX,h=o.panY;e=r+(a-this.viewMapX),i=h+(s-this.viewMapY),e=Math.min(e,0),i=Math.min(i,0);var u=this.mapWidth,c=this.mapHeight;e=-e+this.viewWidth<u?e:this.viewWidth-u,i=-i+this.viewHeight<c?i:this.viewHeight-c,this.mapAPI.pan(e,i)}},{key:"generateMapCanvas",value:function(e){var i=this;return f.a.createElement("canvas",{className:"viewMap",ref:function(t){if(!t)return null;i.viewMapCanvas=t,document.removeEventListener("mousemove",i.updateViewMapCursorPosition),document.addEventListener("mousemove",i.updateViewMapCursorPosition),t.removeEventListener("touchmove",i.handleTouchMove,!1),t.addEventListener("touchmove",i.handleTouchMove,!1),i.mapAPI=new m(t.getContext("2d")),e(i.mapAPI,t)},height:this.viewHeight,width:this.viewWidth,onMouseDown:this.handleMapMouseDown,onTouchStart:this.handleTouchStart,onTouchEnd:this.handleMapTouchEnd,onMouseMove:this.handleMapMouseMove,onMouseUp:this.handleMapMouseUp,onMouseLeave:this.handleMapMouseLeave})}},{key:"generateMiniMapCanvas",value:function(i){var n=this;return f.a.createElement("canvas",{className:"minimap",ref:function(t){if(!t)return null;n.miniMapCanvas=t,document.removeEventListener("mousemove",n.updateMiniMapCursorPosition),document.addEventListener("mousemove",n.updateMiniMapCursorPosition),n.miniMapAPI=new m(t.getContext("2d"));var e=setInterval(function(){n.mapAPI&&(n.updateMiniMapSquare(),clearInterval(e))},100);i(n.miniMapAPI,t)},height:this.mapHeight,width:this.mapWidth,onMouseDown:this.handleMiniMapClick,onTouchStart:this.handleMiniMapTouchStart})}}]),e}();e.default={Entity:c,entityLoop:s,ObjectPool:p,GameCanvas:C}}],a.c=s,a.d=function(t,e,i){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(i,n,function(t){return e[t]}.bind(null,n));return i},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/",a(a.s=1);function a(t){if(s[t])return s[t].exports;var e=s[t]={i:t,l:!1,exports:{}};return n[t].call(e.exports,e,e.exports,a),e.l=!0,e.exports}var n,s});
//# sourceMappingURL=index.js.map