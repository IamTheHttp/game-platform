{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap","webpack:////Users/patrik.tolosa/node_modules/@babel/runtime/helpers/classCallCheck.js","webpack:////Users/patrik.tolosa/node_modules/@babel/runtime/helpers/createClass.js","webpack:///external \"react\"","webpack:////Users/patrik.tolosa/node_modules/@babel/runtime/helpers/toConsumableArray.js","webpack:////Users/patrik.tolosa/node_modules/@babel/runtime/helpers/arrayWithoutHoles.js","webpack:////Users/patrik.tolosa/node_modules/@babel/runtime/helpers/iterableToArray.js","webpack:////Users/patrik.tolosa/node_modules/@babel/runtime/helpers/nonIterableSpread.js","webpack:///./src/lib/ECS/util/entityLoop.js","webpack:///./src/lib/ECS/Group.js","webpack:///./src/lib/ECS/Entity.js","webpack:///./src/lib/CanvasAPI/CanvasAPI.js","webpack:///./src/lib/ObjectPool/ObjectPool.js","webpack:///./src/lib/GameCanvas/SelectedBox/SelectedBox.js","webpack:///./src/lib/GameCanvas/selectionUtils/isPosInsideCircle.js","webpack:///./src/lib/GameCanvas/selectionUtils/getShapesFromClick.js","webpack:///./src/lib/GameCanvas/selectionUtils/getShapesInSelectionBox.js","webpack:///./src/lib/GameCanvas/GameCanvas.js","webpack:///./src/lib/Engine/Engine.js","webpack:///./src/index.js"],"names":["root","factory","exports","module","require","define","amd","a","i","window","__WEBPACK_EXTERNAL_MODULE__2__","installedModules","__webpack_require__","m","instance","Constructor","TypeError","_defineProperties","target","props","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","prototype","arrayWithoutHoles","iterableToArray","nonIterableSpread","arr","Array","isArray","arr2","iter","Symbol","iterator","toString","call","from","entities","fn","ents","forEach","ent","push","keys","entID","Group","components","this","array","groups","reset","generateGroupKey","names","count","name","map","x","toLowerCase","sort","join","getGroup","indexGroup","group","compArray","reduce","entityLoop","entity","hasComponents","id","spliceOne","idx","len","Entity","classRef","counter","constructor","component","compName","groupKey","indexOf","assignGroup","newGroup","copyArray","extendGroup","comp","compInGroup","entHasReqComps","removeComponent","agg","getByComps","type","compNames","concat","destroy","Shape","draw","metaData","ObjectPool","PooledClass","incrementWhenEmpty","freePool","stats","free","used","amount","generate","obj","pop","object","CanvasAPI","ctx","strokeStyle","layers","initial","shapes","Map","defaultStrokeStyle","originCanvas","canvas","parentNode","newCanvas","cloneNode","insertBefore","getContext","querySelector","remove","layerName","layer","clear","image","y","height","width","cropStartX","cropStartY","cropSizeX","cropSizeY","rotation","set","beginPath","save","translate","rotate","drawImage","restore","closePath","drawFn","text","backgroundColor","borderColor","borderWidth","fontSize","fontColor","fontFace","paddingLeft","paddingTop","longestTextWidth","linesOfText","split","fontPxSize","font","fontToUse","measureText","addRect","Math","max","fillColor","lineWidth","write","fillStyle","rect","fill","stroke","direction","size","color","radius","startArc","endArc","arc","PI","moveTo","panX","panY","setTransform","textBaseline","fillText","clearRect","values","SelectedBox","start","end","assign","getWidth","getHeight","isPosInsideCircle","centerX","centerY","pow","getShapesFromClick","hits","shape","shapeMetaData","shapeX","shapeY","getShapesInSelectionBox","selectedData","minX","min","maxX","minY","maxY","GameCanvas","options","noop","selectedBoxColor","mapHeight","mapWidth","viewHeight","viewWidth","onViewMapClick","onViewMapMove","onMiniMapClick","onMiniMapMove","enableSelectBox","lastClick","dbClick","lastTap","selectedBox","updateViewMapCursorPosition","bind","updateMiniMapCursorPosition","handleMapMouseUp","handleMapMouseDown","handleMiniMapClick","handleMiniMapMove","handleMapMouseMove","handleMapMouseLeave","handleTouchMove","handleTouchStart","handleMapTouchEnd","handleMiniMapTouchStart","event","canvasAPI","getBoundingClientRect","clientX","left","clientY","top","round","getPan","isMouseDown","setEnd","viewMapX","viewMapY","data","getData","mapAPI","dbTap","updateCursorPosition","viewMapCanvas","miniMapCanvas","miniMapAPI","miniMapX","miniMapY","getMapRef","getMiniRef","generateMapCanvas","minimap","generateMiniMapCanvas","calcPanX","calcPanY","pan","updateMiniMapSquare","now","Date","getTime","setSelectBox","setStart","e","touches","preventDefault","getRef","className","ref","el","document","removeEventListener","addEventListener","onMouseDown","onTouchStart","onTouchEnd","onMouseMove","onMouseUp","onMouseLeave","setInterval","clearInterval","Engine","systems","frameID","system","sysArgs","requestAnimationFrame","run","systemArguments","runSystems","cancelAnimationFrame","c","d","getter","o","get","r","toStringTag","value","t","mode","__esModule","ns","create","n","property","hasOwnProperty","p","s","moduleId","l","modules"],"mappings":"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","file":"index.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"react\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"react\"], factory);\n\telse {\n\t\tvar a = typeof exports === 'object' ? factory(require(\"react\")) : factory(root[\"react\"]);\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(window, function(__WEBPACK_EXTERNAL_MODULE__2__) {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 7);\n","function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nmodule.exports = _classCallCheck;","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nmodule.exports = _createClass;","module.exports = __WEBPACK_EXTERNAL_MODULE__2__;","var arrayWithoutHoles = require(\"./arrayWithoutHoles\");\n\nvar iterableToArray = require(\"./iterableToArray\");\n\nvar nonIterableSpread = require(\"./nonIterableSpread\");\n\nfunction _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || nonIterableSpread();\n}\n\nmodule.exports = _toConsumableArray;","function _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  }\n}\n\nmodule.exports = _arrayWithoutHoles;","function _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter);\n}\n\nmodule.exports = _iterableToArray;","function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}\n\nmodule.exports = _nonIterableSpread;","/**\n * used to loop over and possibly filter entities\n * Accepts either a map of Entities with EntitiyID as Key, or an array\n * if the CB returns true, an array of entities that return true is returned.\n * @param entities\n * @param fn\n * @returns {Array}\n */\nexport default (entities, fn) => {\n  let ents = [];\n\n  if (entities.forEach) {\n    entities.forEach((ent) => {\n      fn(ent) && ents.push(ent);\n    });\n  } else {\n    Object.keys(entities).forEach((entID) => {\n      fn(entities[entID]) && ents.push(entities[entID]);\n    });\n  }\n\n  return ents;\n};","import entityLoop from './util/entityLoop';\n\n\nclass Group {\n  constructor(components, entities = {}) {\n    this.components = components;\n    this.entities = entities;\n    this.array = [];\n  }\n}\n\nGroup.groups = {};\n\nGroup.reset = () => {\n  Group.groups = {};\n};\n\nGroup.generateGroupKey = (components) => {\n  let names = [];\n  for (let count = 0; count < components.length; count++) {\n    let name = components[count];\n    names.push(name);\n  }\n\n  return names\n    .map((x) => {\n      return x.toLowerCase();\n    })\n    .sort()\n    .join('-');\n};\n\nGroup.getGroup = (components) => {\n  let key = Group.generateGroupKey(components);\n  return Group.groups[key] || {};\n};\n\n// this will create a new index group for the provided components.\nGroup.indexGroup = (components, entities) => {\n  let compArray = components.reduce ? components : [components];\n\n  let key = Group.generateGroupKey(compArray);\n\n  let group;\n\n  if (Group.groups[key]) {\n    return;\n  } else {\n    group = Group.groups[key] = new Group(compArray);\n  }\n\n  // insert the provided entities into this group...\n  entityLoop(entities, (entity) => {\n    if (entity.hasComponents(compArray)) {\n      group.entities[entity.id] = entity;\n      group.array = [...group.array, entity];\n    }\n  });\n\n  return group;\n};\n\nexport default Group;\n\n// life cycle of a group!\n\n// 1. Adding a component adds a group with that one component.\n// 2. Adding 2nd component creates a group with that 2nd component\n// 3. Querying for a list of components should create an group for that list, one off.\n// 4. Adding and removing components will update the above lists as needed.","import Group from './Group';\nimport entityLoop from './util/entityLoop';\n\nexport let spliceOne = function(arr, index = 0) {\n  let idx = index;\n  let len = arr.length;\n  if (!len || idx >= len) {\n    return;\n  }\n\n  while (idx < len) {\n    arr[idx] = arr[idx + 1];\n    idx++;\n  }\n  arr.length--;\n};\n\n\n/**\n * Entity class to a static interface\n *\n * entity.addComponent(Component component)\n *\n */\n\n\nclass Entity {\n  constructor(classRef) {\n    Entity.counter++;\n    this.id = Entity.counter;\n    this.constructor = classRef;\n    this.components = {};\n    Entity.entities[this.id] = this;\n  }\n\n  assignGroup(group) {\n    group.entities[this.id] = this;\n  }\n\n  // A component is added\n  // we create a new group index, for exm\n  addComponent(component) {\n    this.components[component.name] = component;\n    this[component.name] = component;\n    // creates an index group if it does not exist..\n\n    let arr = [];\n    for (let compName in this.components) {\n      arr.push(compName);\n    }\n    Group.indexGroup(arr, Entity.entities);\n\n    // we need to see if we need to add entity into other groups.\n    for (let groupKey in Group.groups) {\n      let group = Group.groups[groupKey];\n      // if the ent is in this group, skip.\n      if (group.entities[this.id]) {\n        continue;\n      }\n      // if the component is not in this group, skip.\n      if (group.components.indexOf(component.name) === -1) {\n        continue;\n      }\n      // if this ent does not have all the other comps, skip..\n      if (this.hasComponents(group.components)) {\n        this.assignGroup(group);\n        let newGroup = this.copyArray(group);\n        group.array = this.extendGroup(newGroup);\n      }\n    }\n  }\n\n  // that's not really copying the array now is it?\n  copyArray(group) {\n    return group.array;\n  }\n\n  extendGroup(newGroup) {\n    newGroup[newGroup.length] = this;\n    return newGroup;\n  }\n\n  // mixed, an actual component or just component name\n  removeComponent(comp) {\n    let component = this.components[comp] || comp;\n    let compName = component.name;\n\n    // we need to see if we need to remove entity from other groups\n    for (let groupKey in Group.groups) {\n      let group = Group.groups[groupKey];\n      // if the ent is in this group, skip.\n\n      let compInGroup = group.components.indexOf(component.name) > -1;\n      let entHasReqComps = this.hasComponents(group.components);\n\n      // if this ent does not have all the other comps, skip..\n      if (group.entities[this.id] && compInGroup && entHasReqComps) {\n        delete group.entities[this.id];\n        spliceOne(group.array, group.array.indexOf(this));\n      }\n    }\n\n    delete this.components[compName];\n    delete this[compName];\n  }\n\n  /**\n   * Destroying an entity means removing all its components and deleting it from the Entity Object\n   */\n  destroy() {\n    Object.keys(this.components).forEach((compName) => {\n      this.removeComponent(this.components[compName]);\n    });\n    delete Entity.entities[this.id];\n  }\n\n  hasComponents(components = []) {\n    // quick breakout\n    if (this.components[components]) {\n      return true;\n    }\n\n    let compNames = components.reduce ? components : [components];\n\n    return compNames.reduce((agg, compName) => {\n      return agg && !!this.components[compName];\n    }, true);\n  }\n}\n\nEntity.entities = {};\n\n/**\n * @param components\n * @param type 'array'|'map'\n * @return return array/map\n */\nEntity.getByComps = (components, type = 'array') => {\n  let compNames = components.reduce ? components : [components];\n  Group.indexGroup(components, Entity.entities);\n  let group = Group.getGroup(compNames);\n  return type === 'map' ? group.entities : group.array.concat();\n};\n\nEntity.reset = () => {\n  entityLoop(Entity.entities, (entity) => {\n    entity.destroy();\n  });\n  Group.reset();\n};\n\nEntity.counter = 0;\n\nwindow.Entity = Entity;\nexport default Entity;","/**\n * Library for working with Canvas,\n * Works by using a 2D context as an argument\n * Provides abstraction for some common shapes in Canvas\n */\n\n\nexport class Shape {\n  constructor(draw, metaData) {\n    this.draw = draw;\n    this.metaData = metaData;\n  }\n}\n\nclass CanvasAPI {\n  constructor(ctx, strokeStyle = 'white') {\n    if (!ctx) {\n      throw 'Cannot create layer, no initial context found';\n    }\n    this.layers = {\n      initial: {\n        ctx,\n        shapes: new Map()\n      }\n    };\n\n    this.defaultStrokeStyle = strokeStyle;\n    ctx.strokeStyle = strokeStyle;\n  }\n\n  addLayer(name) {\n    let originCanvas = this.layers.initial.ctx.canvas;\n\n    let parentNode = originCanvas.parentNode;\n    let newCanvas = originCanvas.cloneNode();\n\n    newCanvas.id = name;\n    parentNode.insertBefore(newCanvas, originCanvas);\n\n    this.layers[name] = {\n      ctx: newCanvas.getContext('2d'),\n      shapes: new Map()\n    };\n  }\n\n  removeLayer(name) {\n    let originCanvas = this.layers.initial.ctx.canvas;\n    let parentNode = originCanvas.parentNode;\n\n    parentNode.querySelector(`#${name}`).remove();\n    delete this.layers[name];\n  }\n\n  /**\n   * Clears all the shapes\n   */\n  clear(layerName = 'initial') {\n    let layer = this.layers[layerName];\n    let ctx = layer.ctx;\n    layer.shapes = new Map();\n  }\n\n  clearAllLayers() {\n    for (let layerName in this.layers) {\n      this.clear(layerName);\n    }\n  }\n\n  /**\n   * Removes a shape by its ID\n   * @param id\n   * @param layerName\n   */\n  remove(id, layerName = 'initial') {\n    let layer = this.layers[layerName];\n    let ctx = layer.ctx;\n    let shapes = layer.shapes;\n    shapes.delete(id);\n  }\n\n  /* istanbul ignore next */\n  addImage({\n    id,\n    image, // the image to display\n    x, y, // pos for x,y..\n    height, width,\n    cropStartX, cropStartY, cropSizeX, cropSizeY,\n    rotation, // in radians\n    layerName = 'initial'\n  }) {\n    let layer = this.layers[layerName];\n    let ctx = layer.ctx;\n    let shapes = layer.shapes;\n\n    shapes.set(id, new Shape(() => {\n      ctx.beginPath();\n      ctx.save();\n      ctx.translate(x + width / 2, y + height / 2);\n      ctx.rotate(rotation);\n      ctx.drawImage(image,\n        cropStartX, cropStartY, cropSizeX, cropSizeY,\n        -width / 2, -height / 2,  // pos in canvas // at the top left of the canvas\n        width, height); // size in canvas\n      ctx.restore();\n      ctx.closePath();\n    }, {\n      id,\n      type: 'image',\n      x,\n      y,\n      height,\n      width\n    }));\n  }\n\n  // TODO Finish this API\n  addShape({id, drawFn, layerName = 'initial'}) {\n    let layer = this.layers[layerName];\n    let ctx = layer.ctx;\n    let shapes = layer.shapes;\n\n    shapes.set(id, new Shape(() => {\n      drawFn(ctx);\n    }));\n  }\n\n  writeBubble({\n    id,\n    text,\n    backgroundColor,\n    borderColor,\n    borderWidth,\n    fontSize,\n    fontColor,\n    x,\n    y,\n    fontFace,\n    height,\n    width,\n    paddingLeft = 10,\n    paddingTop = 10,\n    layerName = 'initial'\n  }) {\n    let longestTextWidth = 0;\n    let linesOfText = text.split('\\n');\n    let fontPxSize = fontSize || this.layers.initial.ctx.font.split('px')[0];\n    let fontToUse = fontFace || this.layers.initial.ctx.font.split('px')[1];\n\n    // set it first for text-width calculations\n    this.layers.initial.ctx.font = `${fontPxSize}px ${fontToUse}`;\n\n    for (let i = 0; i < linesOfText.length; i++) {\n      let {width} = this.layers[layerName].ctx.measureText(linesOfText[i]);\n      longestTextWidth = width > longestTextWidth ? width : longestTextWidth;\n    }\n\n    this.addRect({\n      id: `${id}`,\n      x,\n      y,\n      height: Math.max(height, linesOfText.length * fontPxSize + paddingTop * 2),\n      width: Math.max(width, longestTextWidth + paddingLeft * 2 + borderWidth),\n      fillColor: backgroundColor,\n      lineWidth: borderWidth,\n      strokeStyle: borderColor,\n      layerName\n    });\n\n    for (let i = 0; i < linesOfText.length; i++) {\n      this.write({\n        id: `${id}-bubbleText-${i}`,\n        text: linesOfText[i],\n        x: x + paddingLeft,\n        y: y + fontPxSize + paddingTop + i * fontPxSize,\n        fillStyle: fontColor,\n        font: `${fontPxSize}px ${fontToUse}`,\n        layerName\n      });\n    }\n  }\n\n  addRect({id, x, y, width, height, strokeStyle, lineWidth, fillColor, layerName = 'initial'}) {\n    let layer = this.layers[layerName];\n    let ctx = layer.ctx;\n    let shapes = layer.shapes;\n\n    shapes.set(id, new Shape(() => {\n      ctx.strokeStyle = strokeStyle;\n      ctx.lineWidth = lineWidth;\n      ctx.beginPath();\n      ctx.rect(\n        x,\n        y,\n        width,\n        height\n      );\n      if (fillColor) {\n        ctx.fillStyle = fillColor;\n        ctx.fill();\n      }\n      ctx.stroke();\n      ctx.closePath();\n    }, {\n      id,\n      type: 'rect',\n      x,\n      y,\n      height,\n      width\n    }));\n  }\n\n  addArc({id, direction, size, color = 'black', fillColor, lineWidth = 1, x, y, radius, layerName = 'initial'}) {\n    let layer = this.layers[layerName];\n    let ctx = layer.ctx;\n    let shapes = layer.shapes;\n\n    shapes.set(id, new Shape(() => {\n      ctx.strokeStyle = color;\n      ctx.lineWidth = lineWidth;\n\n      let startArc = direction - (size / 2);\n      let endArc = direction + (size / 2);\n\n      ctx.beginPath();\n      ctx.arc(x, y, radius, startArc * Math.PI, endArc * Math.PI);\n      if (fillColor) {\n        ctx.fillStyle = fillColor;\n        ctx.fill();\n      }\n      ctx.stroke();\n      ctx.closePath();\n    }));\n  }\n\n  addCircle({id, x, y, radius, lineWidth, fillColor, layerName = 'initial'}) {\n    let layer = this.layers[layerName];\n    let ctx = layer.ctx;\n    let shapes = layer.shapes;\n\n    shapes.set(id, new Shape(() => {\n      ctx.lineWidth = lineWidth;\n      ctx.moveTo(x, y);\n      ctx.beginPath();\n      ctx.arc(x, y, radius, 0, Math.PI * 2);\n      if (fillColor) {\n        ctx.fillStyle = fillColor;\n        ctx.fill();\n      }\n      ctx.stroke();\n      ctx.closePath();\n    }, {\n      id,\n      type: 'circle',\n      x,\n      y,\n      radius\n    }));\n  }\n\n  /**\n   * Method allows us to pan around the canvas\n   */\n  pan(x, y) {\n    this.panX = x;\n    this.panY = y;\n\n    for (let layerName in this.layers) {\n      let layer = this.layers[layerName];\n      let ctx = layer.ctx;\n      ctx.setTransform(1, 0, 0, 1, x, y);\n\n      // non initial layers are drawn much less often, so we need a manual one here.\n      if (layerName !== 'initial') {\n        this.draw(layerName); // pan requires a draw to all non initial layers\n      }\n    }\n  }\n\n  getPan() {\n    return {\n      panX: this.panX || 0,\n      panY: this.panY || 0\n    };\n  }\n\n  write({id, text, x, y, font, textBaseline, fillStyle, strokeStyle, layerName = 'initial'}) {\n    let layer = this.layers[layerName];\n    let ctx = layer.ctx;\n    let shapes = layer.shapes;\n\n    shapes.set(id, new Shape(() => {\n      ctx.beginPath();\n      ctx.font = font;\n      ctx.textBaseline = textBaseline;\n      ctx.fillStyle = fillStyle;\n      ctx.strokeStyle = strokeStyle;\n      ctx.fillText(text, x, y);\n      ctx.closePath();\n    }, {\n      id,\n      x,\n      y\n    }));\n  }\n\n  draw(layerName = 'initial') {\n    let layer = this.layers[layerName];\n    let ctx = layer.ctx;\n    let shapes = layer.shapes;\n\n    ctx.save();\n    ctx.setTransform(1, 0, 0, 1, 0, 0);\n    ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n    ctx.restore();\n\n    for (let shape of shapes.values()) {\n      shape.draw();\n      ctx.strokeStyle = this.defaultStrokeStyle;\n    }\n  }\n}\n\n// adding an image causes segmentation fault for some reason :)\n/* istanbul ignore next */\nif (process.env.NODE_ENV === 'test') {\n  CanvasAPI.prototype.addImage = () => {\n  };\n}\nexport default CanvasAPI;","class ObjectPool {\n  constructor(PooledClass, incrementWhenEmpty = 10) {\n    this.type = PooledClass;\n    this.freePool = [];\n    this.stats = {\n      free: 0,\n      used: 0\n    };\n    this.incrementWhenEmpty = incrementWhenEmpty;\n  }\n\n  reset() {\n    this.freePool = [];\n    this.stats = {\n      free: 0,\n      used: 0\n    };\n  }\n\n  // Ensures the pool has at least $amount of free objects\n  generate(amount) {\n    let count = amount - this.stats.free > 0 ? amount - this.stats.free : 0;\n    // generate a gazzilion fighters?\n    while (count > 0) {\n      this.freePool.push(new this.type());\n      count--;\n    }\n    this.stats.free = this.freePool.length;\n  }\n\n  // acquires an object, marks it as 'used'.\n  acquire() {\n    if (this.freePool.length === 0) {\n      this.generate(this.incrementWhenEmpty);\n    }\n    let obj = this.freePool.pop();\n    this.stats.free = this.freePool.length;\n    return obj;\n  }\n\n  // releases an object, marks it as free\n  release(object) {\n    // prevent release twice\n    if (this.freePool.indexOf(object) === -1) {\n      this.freePool.push(object);\n      this.stats.free = this.freePool.length;\n    }\n  }\n}\n\nexport default ObjectPool;","/**\n * Class that represents the current selected area by the user\n * Populated when the user click, holds and move the mouse\n */\nclass SelectedBox {\n  constructor() {\n    this.reset();\n  }\n\n  reset() {\n    this.start = {\n      x: 0,\n      y: 0\n    };\n    this.end = {\n      x: 0,\n      y: 0\n    };\n  }\n\n  getData() {\n    return {\n      start : Object.assign({}, this.start),\n      end : Object.assign({}, this.end),\n      width : this.getWidth(),\n      height : this.getHeight()\n    };\n  }\n\n  getHeight() {\n    return this.end.y - this.start.y;\n  }\n\n  getWidth() {\n    return this.end.x - this.start.x;\n  }\n\n  setStart(x, y) {\n    this.start.x = x;\n    this.start.y = y;\n  }\n\n  setEnd(x, y) {\n    this.end.x = x;\n    this.end.y = y;\n  }\n}\n\nexport default SelectedBox;","/**\n * Utility function to detect if a point is inside a circle\n * @param x\n * @param y\n * @param centerX\n * @param centerY\n * @param radius\n * @return {boolean}\n */\nfunction isPosInsideCircle(x, y, centerX, centerY, radius) {\n  return Math.pow((x - centerX), 2) + Math.pow((y - centerY), 2) < Math.pow(radius, 2);\n}\n\nexport default isPosInsideCircle;","import isPosInsideCircle from './isPosInsideCircle';\n\n\n/**\n * Function used for getting all shapes hit from a single click (not from a selection box)\n */\nfunction getShapesFromClick(shapes, x, y) {\n  let hits = [];\n\n  shapes.forEach((shape, id) => {\n    if (id === 'selectedBox') {\n      return;\n    }\n    let shapeMetaData = shape.metaData || {};\n    let shapeX = shapeMetaData.x;\n    let shapeY = shapeMetaData.y;\n    let radius = shapeMetaData.radius;\n    let width = shapeMetaData.width;\n    let height = shapeMetaData.height;\n    let type = shapeMetaData.type;\n\n    if (type === 'circle' && isPosInsideCircle(x, y, shapeX, shapeY, radius)) {\n      hits.push(id);\n    } else if (type === 'rect' || type === 'image') {\n      if (x >= shapeX && x <= shapeX + width && y >= shapeY && y <= shapeY + height) {\n        hits.push(id);\n        // do nothing, no support for non circles\n      }\n    } else if (type !== 'circle') {\n\n    }\n  });\n\n  return hits;\n}\n\nexport default getShapesFromClick;","function getShapesInSelectionBox(shapes, selectedData) {\n  let minX = Math.min(selectedData.start.x, selectedData.end.x);\n  let maxX = Math.max(selectedData.start.x, selectedData.end.x);\n  let minY = Math.min(selectedData.start.y, selectedData.end.y);\n  let maxY = Math.max(selectedData.start.y, selectedData.end.y);\n\n\n  let hits = [];\n  shapes.forEach((shape, id) => {\n    if (id === 'selectedBox') {\n      return;\n    }\n    let shapeMetaData = shape.metaData || {};\n    let shapeX = shapeMetaData.x;\n    let shapeY = shapeMetaData.y;\n    let radius = shapeMetaData.radius;\n    let width = shapeMetaData.width;\n    let height = shapeMetaData.height;\n    let type = shapeMetaData.type;\n\n    if (type === 'circle') {\n      let centerX = shapeX;\n      let centerY = shapeY;\n      if (centerX >= minX && centerX <= maxX && centerY >= minY && centerY <= maxY) {\n        hits.push(id);\n      }\n    } else if (type === 'rect' || type === 'image') {\n      // what is considered the 'centerX' for a rect?\n      let centerX = shapeX + width / 2;\n      let centerY = shapeY + height / 2;\n\n      if (centerX >= minX && centerX <= maxX && centerY >= minY && centerY <= maxY) {\n        hits.push(id);\n      }\n    } else {\n      // do nothing, no support for non circles or rects\n    }\n  });\n\n  return hits;\n}\n\nexport default getShapesInSelectionBox;","import React from 'react';\nimport CanvasAPI from 'lib/CanvasAPI/CanvasAPI';\nimport SelectedBox from './SelectedBox/SelectedBox';\nimport getShapesFromClick from './selectionUtils/getShapesFromClick';\nimport getShapesInSelectionBox from './selectionUtils/getShapesInSelectionBox';\n\nclass GameCanvas {\n  constructor(options) {\n    let noop = () => {\n    };\n    this.selectedBoxColor = options.selectedBoxColor || 'blue';\n    this.mapHeight = options.mapHeight;\n    this.mapWidth = options.mapWidth;\n    this.viewHeight = options.viewHeight;\n    this.viewWidth = options.viewWidth;\n    this.onViewMapClick = options.onViewMapClick || noop;\n    this.onViewMapMove = options.onViewMapMove || noop;\n    this.onMiniMapClick = options.onMiniMapClick || noop;\n    this.onMiniMapMove = options.onMiniMapMove || noop;\n    this.enableSelectBox = options.enableSelectBox;\n\n    this.lastClick = 0;\n    this.dbClick = false;\n    this.lastTap = 0;\n    this.lastClick = false;\n    this.selectedBox = new SelectedBox();\n    this.updateViewMapCursorPosition = this.updateViewMapCursorPosition.bind(this);\n    this.updateMiniMapCursorPosition = this.updateMiniMapCursorPosition.bind(this);\n    this.handleMapMouseUp = this.handleMapMouseUp.bind(this);\n    this.handleMapMouseDown = this.handleMapMouseDown.bind(this);\n    this.handleMiniMapClick = this.handleMiniMapClick.bind(this);\n    this.handleMiniMapMove = this.handleMiniMapMove.bind(this);\n    this.handleMapMouseMove = this.handleMapMouseMove.bind(this);\n    this.handleMapMouseLeave = this.handleMapMouseLeave.bind(this);\n    this.handleTouchMove = this.handleTouchMove.bind(this);\n    this.handleTouchStart = this.handleTouchStart.bind(this);\n    this.handleMapTouchEnd = this.handleMapTouchEnd.bind(this);\n    this.handleMiniMapTouchStart = this.handleMiniMapTouchStart.bind(this);\n  }\n\n  updateCursorPosition(event, canvas, canvasAPI) {\n    let rect = canvas.getBoundingClientRect();\n    // base position\n    let x = event.clientX - rect.left;\n    let y = event.clientY - rect.top;\n\n    x = Math.max(0, Math.round(x * (canvas.width / rect.width))) - canvasAPI.getPan().panX;\n    y = Math.max(0, Math.round(y * (canvas.height / rect.height))) - canvasAPI.getPan().panY;\n\n    return {x, y};\n  }\n\n  handleMapMouseMove() {\n    if (this.isMouseDown) {\n      if (this.enableSelectBox === false) {\n        return;\n      } else {\n        this.selectedBox.setEnd(this.viewMapX, this.viewMapY);\n        let data = this.selectedBox.getData();\n\n        this.mapAPI.addRect({\n          id: 'selectedBox',\n          x: data.start.x,\n          y: data.start.y,\n          width: data.width,\n          height: data.height,\n          strokeStyle: this.selectedBoxColor\n        });\n      }\n    }\n\n    this.onViewMapMove({\n      x: this.viewMapX,\n      y: this.viewMapY,\n      isMouseDown: this.isMouseDown,\n      dbClick: this.dbClick,\n      selectedBox: this.selectedBox.getData()\n    });\n  }\n\n  handleMapMouseLeave() {\n    if (this.isMouseDown) {\n      this.handleMapMouseUp();\n    }\n  }\n\n  handleMapTouchEnd() {\n    this.isMouseDown = false;\n\n    let selectedData = this.selectedBox.getData();\n\n    let hits = [];\n    // if a single click...\n    if (selectedData.end.x === selectedData.start.x) {\n      let x = selectedData.end.x;\n      let y = selectedData.end.y;\n      // TODO if we wanted to support hit detection against all layers\n      // TODO this is where we'd intervene to loop over all layers\n      hits = getShapesFromClick(this.mapAPI.layers.initial.shapes, x, y);\n    } else {\n      hits = getShapesInSelectionBox(this.mapAPI.layers.initial.shapes, selectedData);\n    }\n\n    this.mapAPI.addRect({\n      id: 'selectedBox',\n      x: 0,\n      y: 0,\n      width: 0,\n      height: 0\n    });\n\n    this.onViewMapClick({\n      x: this.viewMapX,\n      y: this.viewMapY,\n      isMouseDown: this.isMouseDown,\n      dbClick: this.dbTap || this.dbClick,\n      selectedBox: selectedData,\n      hits\n    });\n    this.selectedBox.reset();\n  }\n\n  handleMapMouseUp() {\n    if (!this.lastTap) {\n      this.handleMapTouchEnd();\n    }\n  }\n\n\n  updateViewMapCursorPosition(event) {\n    let {x, y} = this.updateCursorPosition(event, this.viewMapCanvas, this.mapAPI);\n    this.viewMapX = x;\n    this.viewMapY = y;\n  }\n\n  updateMiniMapCursorPosition(event) {\n    let {x, y} = this.updateCursorPosition(event, this.miniMapCanvas, this.miniMapAPI);\n    this.miniMapX = x;\n    this.miniMapY = y;\n  }\n\n  getNewCanvasPairs({getMapRef, getMiniRef}) {\n    return {\n      map: this.generateMapCanvas(getMapRef),\n      minimap: this.generateMiniMapCanvas(getMiniRef)\n    };\n  }\n\n  handleMiniMapMove(event) {\n    this.onMiniMapMove(event);\n  }\n\n  handleMiniMapClick(event) {\n    let x = this.miniMapX;\n    let y = this.miniMapY;\n    // Handle negative overflows, both numbers should be positive\n    // the reason we divide in 2 is because we want to center the view\n    let calcPanX = Math.max(x - this.viewWidth / 2, 0);\n    let calcPanY = Math.max(y - this.viewHeight / 2, 0);\n\n    // Handle positive overflows, both numbers should not exceed map size\n    let width = this.mapWidth;\n    let height = this.mapHeight;\n\n    calcPanX = calcPanX + this.viewWidth < width ? calcPanX : width - this.viewWidth;\n    calcPanY = calcPanY + this.viewHeight < height ? calcPanY : height - this.viewHeight;\n\n    this.mapAPI.pan(-calcPanX, -calcPanY);\n\n    // draw the minimap square box\n    this.updateMiniMapSquare();\n    this.onMiniMapClick(event);\n  }\n\n  updateMiniMapSquare() {\n    this.miniMapAPI.addRect({\n      id: 'currentMap',\n      x: -this.mapAPI.getPan().panX,\n      y: -this.mapAPI.getPan().panY,\n      width: this.viewWidth,\n      height: this.viewHeight,\n      strokeStyle: 'green',\n      lineWidth: 20\n    });\n  }\n\n  handleMapMouseDown() {\n    if (!this.lastTap) {\n      let now = new Date().getTime();\n      this.dbClick = (now - this.lastClick) < 300;\n      this.lastClick = now;\n      this.isMouseDown = true;\n      this.setSelectBox();\n    }\n  }\n\n  setSelectBox() {\n    if (this.enableSelectBox === false) {\n      return;\n    }\n\n    this.selectedBox.setStart(this.viewMapX, this.viewMapY);\n    this.selectedBox.setEnd(this.viewMapX, this.viewMapY);\n  }\n\n  handleTouchStart(e) {\n    let {x, y} = this.updateCursorPosition(e.touches[0], this.viewMapCanvas, this.mapAPI);\n    let now = new Date().getTime();\n\n    this.dbTap = (now - this.lastTap) < 300;\n    this.lastTap = now;\n\n    this.viewMapX = x;\n    this.viewMapY = y;\n\n    this.setSelectBox();\n  }\n\n  handleMiniMapTouchStart(e) {\n    let {x, y} = this.updateCursorPosition(e.touches[0], this.miniMapCanvas, this.miniMapAPI);\n\n    this.miniMapX = x;\n    this.miniMapY = y;\n\n    this.handleMiniMapClick();\n  }\n\n\n  handleTouchMove(e) {\n    e.preventDefault();\n    let {x, y} = this.updateCursorPosition(e.touches[0], this.viewMapCanvas, this.mapAPI);\n\n    let calcPanX;\n    let calcPanY;\n    let {panX, panY} = this.mapAPI.getPan();\n\n    let xMoved = x - this.viewMapX;\n    let yMoved = y - this.viewMapY;\n\n    calcPanX = panX + xMoved;\n    calcPanY = panY + yMoved;\n\n    // both numbers should be negative\n    calcPanX = Math.min(calcPanX, 0);\n    calcPanY = Math.min(calcPanY, 0);\n\n    // the panning + the mapSize, should not exceed the viewSize\n    let width = this.mapWidth;\n    let height = this.mapHeight;\n    calcPanX = -calcPanX + this.viewWidth < width ? calcPanX : this.viewWidth - width;\n    calcPanY = -calcPanY + this.viewHeight < height ? calcPanY : this.viewHeight - height;\n\n    this.mapAPI.pan(calcPanX, calcPanY);\n  }\n\n  generateMapCanvas(getRef) {\n    return (\n      <canvas\n        className='viewMap'\n        ref={(el) => {\n          if (!el) {\n            return null;\n          }\n\n          if (process.env.NODE_ENV === 'test' && !el.removeEventListener) {\n            el = el._reactInternalFiber.child.stateNode; // eslint-disable-line\n          }\n\n          this.viewMapCanvas = el;\n          document.removeEventListener('mousemove', this.updateViewMapCursorPosition);\n          document.addEventListener('mousemove', this.updateViewMapCursorPosition);\n          el.removeEventListener('touchmove', this.handleTouchMove, false);\n          el.addEventListener('touchmove', this.handleTouchMove, false);\n\n          this.mapAPI = new CanvasAPI(el.getContext('2d'));\n          getRef(this.mapAPI, el);\n        }}\n        height={this.viewHeight}\n        width={this.viewWidth}\n        onMouseDown={this.handleMapMouseDown}\n        onTouchStart={this.handleTouchStart}\n        onTouchEnd={this.handleMapTouchEnd}\n        onMouseMove={this.handleMapMouseMove}\n        onMouseUp={this.handleMapMouseUp}\n        onMouseLeave={this.handleMapMouseLeave}\n      ></canvas>\n    );\n  }\n\n  generateMiniMapCanvas(getRef) {\n    return (\n      <canvas\n        className='minimap'\n        ref={(el) => {\n          if (!el) {\n            return null;\n          }\n\n          if (process.env.NODE_ENV === 'test' && !el.removeEventListener) {\n            el = el._reactInternalFiber.child.stateNode; // eslint-disable-line\n          }\n\n          this.miniMapCanvas = el;\n          document.removeEventListener('mousemove', this.updateMiniMapCursorPosition);\n          document.addEventListener('mousemove', this.updateMiniMapCursorPosition);\n\n          this.miniMapAPI = new CanvasAPI(el.getContext('2d'));\n\n          // TODO - what? why? is this needed?\n          let key = setInterval(() => {\n            if (this.mapAPI) {\n              this.updateMiniMapSquare();\n              clearInterval(key);\n            }\n          }, 100);\n\n          getRef(this.miniMapAPI, el);\n        }}\n        height={this.mapHeight}\n        width={this.mapWidth}\n        onMouseMove={this.handleMiniMapMove}\n        onMouseDown={this.handleMiniMapClick}\n        onTouchStart={this.handleMiniMapTouchStart}\n      ></canvas>\n    );\n  }\n}\n\nexport default GameCanvas;","class Engine {\n  constructor() {\n    this.systems = [];\n    this.frameID = null;\n  }\n\n  addSystem(system) {\n    this.systems.push(system);\n  }\n\n  run(sysArgs) {\n    this.frameID = requestAnimationFrame(() => {\n      this.run(sysArgs); // // Load the next frame request, this will allow any system to cancel the frame\n      let systemArguments = typeof sysArgs === 'function' ? sysArgs() : sysArgs;\n\n      this.runSystems(systemArguments);\n    });\n\n    return this.frameID;\n  }\n\n  runSystems(systemArguments) {\n    for (let i = 0; i < this.systems.length; i++) {\n      this.systems[i](systemArguments);\n    }\n  }\n\n  stop() {\n    cancelAnimationFrame(this.frameID);\n    return this.frameID;\n  }\n}\n\n\nexport default Engine;","import Entity from 'lib/ECS/Entity';\nimport entityLoop from 'lib/ECS/util/entityLoop';\nimport ObjectPool from 'lib/ObjectPool/ObjectPool';\nimport GameCanvas from 'lib/GameCanvas/GameCanvas';\nimport Engine from 'lib/Engine/Engine';\n\nexport default {\n  Entity,\n  entityLoop,\n  ObjectPool,\n  GameCanvas,\n  Engine\n};"],"sourceRoot":""}